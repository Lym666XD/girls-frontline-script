[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=7bd5aa16-cc6f-4099-9ddb-eaef992dbe46
Description=8-1n
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=2
QUI=
[Relative]
SetupOCXFile=
[Comment]

[Script]
//8-1n

//resolution 960 540
DimEnv X, Y//点击位置修正
X = 6
Y = 46
Dim Totaltimes//计算打了多少次
Totaltime=0
DimEnv Battletimes//战斗次数 第一回合为3 第二回合为2
Battletimes = 0
Dimenv Isbattle
Isbattle = False
Dimenv Needchange
Needchange=True
DimEnv GetColor
DimEnv positionX,positionY
Dimenv EndmarkX,EndmarkY
EndmarkX = 768
EndmarkY= 490
//768 490 06AAFE
Dimenv Presetmark1X, Presetmark1Y
Presetmark1X = 868
Presetmark1Y = 449
//00B4FF
DimEnv Presetmark2X, Presetmark2Y
Presetmark2X =49
Presetmark2Y = 16

//FFFFFF
Dim BacktobaseX, BacktobaseY
BacktobaseX = 29
BacktobaseY = 59
//00BBFF
Dim IssupportX, IssupportY
IssupportX = 60
IssupportY = 262
//FFFFFF

//Buttons
Dim ContinuesupportX, ContinuesupportY//继续后勤按钮
ContinuesupportX =560
ContinuesupportY =374
Dim FactoryX, FactoryY//工厂
FactoryX=867
FactoryY=253
Dim RetireX, RetireY//拆解
RetireX=72
RetireY = 325


Dim ChoosegearX, ChoosegearY//选择装备

Dim AutoselectX, AutoselectY//智能选择or确定
AutoselectX=890
AutoselectY=473
Dim DisassembleX, DisassembleY//拆解
DisassembleX=879
DisassembleY = 468
Dim ImprovecombatX, ImprovecombatY//作战开始时仓库满了 装备强化
ImprovecombatX=600
ImprovecombatY=371
Dim CombatX, CombatY//主界面战斗
CombatX=694
CombatY = 373
Dim ChoosecombatX, ChoosecombatY//战斗中的选择战役
ChoosecombatX =64
ChoosecombatY =109
Dim Campaign8X,Campaign8Y//第8战役
Campaign8X=188
Campaign8Y=223
Dim MidnightX, MidnightY//夜战
MidnightX=911
MidnightY=141
Dim Battle0801nX,Battle0801nY//第1战斗
Battle0801nX=569
Battle0801nY=206
Dim StartnormalX,StartnormalY//普通作战
StartnormalX=560
StartnormalY=437
Dim CwithdrawX, CwithdrawY
CwithdrawX = 751
CwithdrawY = 483
Dim AirportdownX,AirportdownY
AirportdownX=137 
AirportdownY=420
Dim AirportupX,AirportupY
AirportupX= 210
AirportupY= 30
Dim point1X, point2X, point3X, point4X, point5X
Dim point1Y, point2Y, point3Y, point4Y, point5Y
point1X=222
point1Y=335
point2X=236
point2Y=219
point3X=241
point3Y=136
point4X =104
point4Y =163
point5X =116 
point5Y =304
Dim FormationinbattleX,FormationinbattleY//队伍编成 橘红色按钮
FormationinbattleX=180
FormationinbattleY=466
Dim FormationpresetX,FormationpresetY//阵型预设
FormationpresetX=883
FormationpresetY=489
Dim PresetX, Preset1X, Preset2X, UsepresetX,PresetY, Preset1Y, Preset2Y, UsepresetY
PresetX=934//预设 小橘红色按钮
PresetY=207//预设 小橘红色按钮
Preset1X=744
Preset1Y=63
Preset2X=740
Preset2Y=152
UsepresetX= 849
UsepresetY = 476
Dim ForcedreplaceX, ForcedreplaceY//强制替换按钮
ForcedreplaceX=430
ForcedreplaceY=314
Dim Ok_presetX,Ok_presetY//阵型预设下面的OK
Ok_presetX=873
Ok_presetY=475
Dim Ok_deployX,Ok_deployY//选择梯队的OK
Ok_deployX=880
Ok_deployY=486
Dim HomeX, HomeY//返回 位置基本上一样
HomeX=48
HomeY = 36
Dim PlannedX, PlannedY//计划模式
PlannedX=55
PlannedY = 442
Dim SupplyX, SupplyY//补给
SupplyX = 885
SupplyY=419
Dim StartX, StartY//开始作战
StartX=853
StartY=490
Dim AbortX,AbortY//终止作战
AbortX=238
AbortY=32
Dim RestartX, RestartY//重新作战
RestartX = 367
RestartY = 369
Dim OK_withdrawX, OK_withdrawY//撤退的ok
OK_withdrawX = 561
OK_withdrawY = 372
Dim OK_forcepresetX, OK_forcepresetY
OK_forcepresetX = 611
OK_forcepresetY = 378
Dim OK_formationX, OK_formationY
OK_formationX =874
OK_formationY = 481
Dim GoplanX, GoplanY
GoplanX=880
GoplanY = 499
Dim Dpoint1X, Dpoint1Y
Dpoint1X=189
Dpoint1Y=266
Dim Dpoint2X, Dpoint2Y
Dpoint2X=44
Dpoint2Y=104
Function Cr(a,b,Dtime,Cscale,Tscale)
	
	Dim Xrscale, Yrscale, Delaytime
	//Randomize
	Xrscale = Int(Rnd() * Cscale) - Int(Cscale / 2)//rnd()->0
	//Randomize
	Yrscale = Int(Rnd() * Cscale) - Int(Cscale / 2)
	//TracePrint "要求点击a:" & a & "要求点击b:" & b
	//TracePrint "X方向随机位移" & Xrscale & "Y方向随机位移" & Yrscale
	a = a + Xrscale
	b = b + Yrscale
	//TracePrint "随机位移后点击a:" & a & "随机位移后点击b:" & b
	a = positionX+ a + X 
	b = positionY + b + Y 
	MoveTo a, b
	LeftClick 1
	Randomize
	//TracePrint "要求延迟" & Dtime & "毫秒"
	Delaytime = Int(100 * Tscale * Rnd())
	//TracePrint "随机延迟" & Delaytime & "毫秒"
	Delaytime = Delaytime + Dtime
	//TracePrint "实际延迟" & Delaytime & "毫秒"
	Delay Delaytime
	
End Function

Function Dr(a,b,Cscale,Tscale)
	
	Dim Xrscale, Yrscale, Delaytime
	
		Randomize
		Xrscale = Int(Rnd() * Cscale) - Int(Cscale / 2)
		Randomize
		Yrscale = Int(Rnd() * Cscale) - Int(Cscale / 2)
		a = positionX+ a + X + Xrscale
		b = positionY + b + Y + Yrscale
		MoveTo a, b
	For i = 0 To 30
		Randomize
		MouseWheel -20
		Delay 50+Int(10 * Tscale * Rnd())
	Next
End Function

Function Disassmble()
	
End Function

Function Formchange8_1n()
	
	TracePrint "点击 机场下"
	Call Cr(AirportdownX,AirportdownY,1000,10,10)
	TracePrint "点击 队伍编成"
	Call Cr(FormationinbattleX,FormationinbattleY,3000,20,10)
	TracePrint "点击 阵型预设"
	Call Cr(FormationpresetX,FormationpresetY,1000,40,10)
	TracePrint "点击 预设"
	Call Cr(PresetX,PresetY,1000,20,10)
	TracePrint "点击 预设队伍1"
	Call Cr(Preset1X,Preset1Y,1000,40,10)
	TracePrint "点击 套用预设"
	Call Cr(UsepresetX,UsepresetY,1000,20,10)
	TracePrint "点击 强制替换选项"
	Call Cr(ForcedreplaceX,ForcedreplaceY,1000,20,10)
	TracePrint "点击 确定（强制替换）"
	Call Cr(OK_forcepresetX, OK_forcepresetY, 1000, 40, 10)
	GetColor = GetPixelColor(positionX+X+Presetmark1X, PositionY+Y+Presetmark1Y)
	While GetColor <> "00B4FF"
		TracePrint "检查是否能点确定"
		GetColor = GetPixelColor(positionX + X + Presetmark1X, PositionY + Y + Presetmark1Y)
		Delay 500
	Wend
	TracePrint "点击 确定（预设）"
	Call Cr(OK_formationX, OK_formationY, 1000, 60, 10)
	While GetColor <> "FFFFFF"
		TracePrint "检查是否能点返回" & GetColor & positionX + X + Presetmark2X &positionY + Y + Presetmark2Y
		GetColor = GetPixelColor(positionX + X + Presetmark2X, PositionY + Y + Presetmark2Y)
		Delay 500
	Wend
	TracePrint "点击 返回"
	Call Cr(HomeX, HomeY, 5000, 20, 10)
	NeedChange=False
	
End Function

Function Combat()
	For 5
		
		While Isbattle = False
			//TracePrint "判断黄条是否出现"
			GetColor = GetPixelColor(positionX+X+464, PositionY+Y+10)//464+6 10+46
			//TracePrint "464 10颜色" & GetColor
			If	GetColor = "00BBFF" Then
				//TracePrint "黄条出现"
				Isbattle = True
			End If
			Delay 200 + Int(Rnd() * 100)
			//TracePrint "每隔200ms左右判断是否战斗中"
		Wend
		While Isbattle = True
			//TracePrint "检测黄条是否消失"
			GetColor = GetPixelColor(positionX+X+464, PositionY+Y+10)
			//TracePrint "476 58颜色" & GetColor
			If	GetColor <> "00BBFF" Then
				//TracePrint "黄条消失"
				Isbattle = False
			End If
			Delay 500 + Int(Rnd() * 100)
		Wend
		//TracePrint "点击 安全位置 6次 每次300ms"	
		Call Cr(606, 66, 800, 80, 10)//600+6  20+46
		Call Cr(606, 66, 800, 80, 10)
		Call Cr(606, 66, 800, 80, 10)
		Call Cr(606, 66, 800, 80, 10)
	Next
End Function

Dim Hwnd,sRect
Hwnd = Plugin.Window.Find("BS2CHINAUI", "BlueStacks App Player")
traceprint "查找到的父窗口句柄为：" & Hwnd
sRect = Plugin.Window.GetWindowRect(Hwnd)   
traceprint "窗口左上点和右下点坐标为"&sRect
Dim MyArray
MyArray=Split(sRect,"|")
positionX=CLng(MyArray(0))
positionY= CLng(MyArray(1))
TracePrint "窗口左上点坐标为" & positionX & "," & positionY
TracePrint "开始作战" 
TracePrint "已进行作战数" & Totaltimes
TracePrint "点击 战斗"
Call Cr(CombatX, CombatY, 1000, 80, 20)//20延时最大两秒
TracePrint "点击 战役"
Call Cr(ChoosecombatX, ChoosecombatY, 800, 40, 10)
Call Dr(Dpoint1X, Dpoint1Y, 20, 1)
Randomize
Delay 1000+Int(Rnd()*1000)
Call Cr(Campaign8X, Campaign8Y, 800, 40, 10)
Call Cr(MidnightX, MidnightY, 800, 40, 10)
Call Cr(Battle0801nX, Battle0801nY, 800, 40, 10)
Call Cr(StartnormalX, StartnormalY, 3000, 40, 10)
KeyDown "Ctrl",1
Call Dr(Dpoint2X,Dpoint2Y,20,1)
KeyUp "Ctrl",1
Rem next0
Call Formchange8_1n()
Call Cr(AirportdownX, AirportdownY, 800, 10, 10)
Call Cr(Ok_deployX, Ok_deployY, 1000, 40, 10)
Call Cr(AirportupX, AirportupY, 800, 10, 10)
Call Cr(Ok_deployX, Ok_deployY, 800, 40, 10)
Call Cr(StartX, StartY, 3000, 40, 10)
Call Cr(AirportdownX, AirportdownY, 800, 10, 10)
Call Cr(AirportdownX, AirportdownY, 800, 10, 10)
Call Cr(SupplyX, SupplyY, 1000, 40, 10)
Call Cr(AirportdownX, AirportdownY, 1000, 10, 10)
Call Cr(CwithdrawX, CwithdrawY, 1000, 40, 10)
Call Cr(OK_withdrawX, OK_withdrawY, 1000, 20, 10)
Call Cr(AbortX,AbortY, 1000, 40, 10)
Call Cr(RestartX, RestartY, 4000, 40, 10)
Call Cr(AirportdownX, AirportdownY, 1000, 10, 10)
Call Cr(FormationinbattleX,FormationinbattleY,3000,20,10)
Call Cr(FormationpresetX,FormationpresetY,1000,40,10)
Call Cr(PresetX, PresetY, 1000, 20, 10)
Call Cr(Preset2X,Preset2Y,1000,40,10)
Call Cr(UsepresetX,UsepresetY,2000,20,10)
GetColor = GetPixelColor(positionX+X+Presetmark1X, PositionY+Y+Presetmark1Y)
While GetColor <> "00B4FF"
	TracePrint "检查是否能点确定"
	GetColor = GetPixelColor(positionX + X + Presetmark1X, PositionY + Y + Presetmark1Y)
	Delay 500
Wend
TracePrint "点击 确定（预设）"
Call Cr(OK_formationX, OK_formationY, 1000, 60, 10)
While GetColor <> "FFFFFF"
	TracePrint "检查是否能点返回" & GetColor & positionX + X + Presetmark2X &positionY + Y + Presetmark2Y
	GetColor = GetPixelColor(positionX + X + Presetmark2X, PositionY + Y + Presetmark2Y)
	Delay 500
Wend
TracePrint "点击 返回"
Call Cr(HomeX, HomeY, 3000, 20, 10)
Call Cr(AirportdownX, AirportdownY, 1000, 10, 10)
Call Cr(Ok_deployX, Ok_deployY, 1000, 40, 10)
Call Cr(StartX, StartY, 3000, 40, 10)
Call Cr(AirportdownX, AirportdownY, 1000, 10, 10)
Call Cr(PlannedX, PlannedY,1000, 20, 10)
Call Cr(point1X, point1Y, 800, 40, 8)
Call Cr(point2X, point2Y, 800, 40, 8)
Call Cr(point3X, point3Y, 800, 40, 8)
Call Cr(point4X, point4Y, 800, 40, 8)
Call Cr(point5X, point5Y, 800, 40, 8)
Call Cr(GoplanX, GoplanY, 1000, 40, 10)
Needchange=True
Delay 120000
While 1
	TracePrint "检查是否可以回合结束"
	GetColor = GetPixelColor(positionX+X+EndmarkX, PositionY+Y+EndmarkY)
	TracePrint "768 490颜色" & GetColor
	If GetColor = "06AAFE" Then 
		Delay 500 + Int(Rnd() * 100)
		Goto Next2
	End If
	Delay 200
Wend
Randomize
Rem Next2
Delay 2000+Int(Rnd()*1000)
Call Cr(AbortX,AbortY, 1000, 40, 10)
Call Cr(RestartX, RestartY, 3500, 40, 10)
Goto next0









